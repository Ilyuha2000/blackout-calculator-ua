<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–≤–µ—Ç–∞</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container, .history-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; margin-bottom: 20px; }
        h2, h3 { text-align: center; color: #222; }
        
        /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã */
        .date-selector { margin-bottom: 20px; text-align: center; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .row { display: flex; align-items: center; gap: 8px; margin-bottom: 15px; padding: 10px; background: #fafafa; border-radius: 8px; border: 1px solid #eee; }
        .time-box { display: flex; flex-direction: column; flex: 1; }
        label { font-size: 0.7rem; color: #888; font-weight: bold; }
        .inputs { display: flex; gap: 4px; }
        input[type="number"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; text-align: center; }
        
        .btn-add { background: #6c757d; color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
        .btn-calc { background: #007bff; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; cursor: pointer; font-weight: bold; }
        
        /* –°—Ç–∏–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ */
        .history-item { border-bottom: 1px solid #eee; padding: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background 0.2s; }
        .history-item:hover { background: #f1f8ff; border-radius: 8px; }
        .history-date { font-weight: bold; color: #555; }
        .history-val { color: #d32f2f; font-weight: bold; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ) */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 100; }
        .modal { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 350px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .modal h4 { margin-top: 0; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .modal-content { margin: 15px 0; line-height: 1.6; }
        .btn-close { background: #222; color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; }

        .btn-del-small { background: none; border: none; color: #ccc; cursor: pointer; font-size: 1.2rem; margin-left: 10px; }
        .btn-del-small:hover { color: red; }
    </style>
</head>
<body>

<div class="container">
    <h2>‚è± –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–≤–µ—Ç–∞</h2>
    <div class="date-selector">
        <label>–î–∞—Ç–∞:</label> <input type="date" id="targetDate">
    </div>
    
    <div id="periods">
        <div class="row">
            <div class="time-box">
                <label>–í—ã–∫–ª</label>
                <div class="inputs">
                    <input type="number" class="h1" placeholder="–ß–ß">
                    <input type="number" class="m1" placeholder="–ú–ú">
                </div>
            </div>
            <div style="margin-top: 15px;">‚Üí</div>
            <div class="time-box">
                <label>–í–∫–ª</label>
                <div class="inputs">
                    <input type="number" class="h2" placeholder="–ß–ß">
                    <input type="number" class="m2" placeholder="–ú–ú">
                </div>
            </div>
        </div>
    </div>

    <button class="btn-add" onclick="addPeriod()">+ –ï—â–µ –ø–µ—Ä–∏–æ–¥</button>
    <button class="btn-calc" onclick="calculateAndSave()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
</div>

<div class="history-card">
    <h3>üìÖ –ñ—É—Ä–Ω–∞–ª (–Ω–∞–∂–º–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π)</h3>
    <div id="history-items"></div>
</div>

<div id="modal-overlay" onclick="closeModal()">
    <div class="modal" onclick="event.stopPropagation()">
        <h4 id="modal-title">–î–µ—Ç–∞–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è</h4>
        <div id="modal-body" class="modal-content"></div>
        <button class="btn-close" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    window.onload = function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('targetDate').value = today;
        renderHistory();
    };

    function addPeriod() {
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `
            <div class="time-box"><label>–í—ã–∫–ª</label><div class="inputs"><input type="number" class="h1" placeholder="–ß–ß"><input type="number" class="m1" placeholder="–ú–ú"></div></div>
            <div style="margin-top: 15px;">‚Üí</div>
            <div class="time-box"><label>–í–∫–ª</label><div class="inputs"><input type="number" class="h2" placeholder="–ß–ß"><input type="number" class="m2" placeholder="–ú–ú"></div></div>`;
        document.getElementById('periods').appendChild(div);
    }

    function calculateAndSave() {
        const rows = document.querySelectorAll('.row');
        const rawDate = document.getElementById('targetDate').value;
        if (!rawDate) return;

        let totalMinutes = 0;
        let intervals = [];

        rows.forEach(row => {
            const h1 = row.querySelector('.h1').value;
            const m1 = row.querySelector('.m1').value;
            const h2 = row.querySelector('.h2').value;
            const m2 = row.querySelector('.m2').value;

            if (h1 !== "" && h2 !== "") {
                let start = parseInt(h1) * 60 + (parseInt(m1) || 0);
                let end = parseInt(h2) * 60 + (parseInt(m2) || 0);
                if (end < start) end += 24 * 60;
                
                totalMinutes += (end - start);
                intervals.push(`${h1}:${m1.padStart(2,'0')} ‚Äî ${h2}:${m2.padStart(2,'0')}`);
            }
        });

        if (intervals.length === 0) return;

        const dateObj = new Date(rawDate);
        const formattedDate = dateObj.toLocaleDateString('ru-RU');
        
        let history = JSON.parse(localStorage.getItem('lightHistoryDetailed') || '[]');
        history.unshift({
            id: Date.now(),
            date: formattedDate,
            total: formatTime(totalMinutes),
            details: intervals
        });

        localStorage.setItem('lightHistoryDetailed', JSON.stringify(history));
        renderHistory();
        
        // –û—á–∏—Å—Ç–∫–∞
        document.getElementById('periods').innerHTML = '';
        addPeriod();
    }

    function formatTime(minutes) {
        return `${Math.floor(minutes / 60)} —á. ${minutes % 60} –º–∏–Ω.`;
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('lightHistoryDetailed') || '[]');
        const container = document.getElementById('history-items');
        container.innerHTML = history.map(item => `
            <div class="history-item" onclick="showDetails(${item.id})">
                <span class="history-date">${item.date}</span>
                <span class="history-val">${item.total}</span>
                <button class="btn-del-small" onclick="event.stopPropagation(); deleteEntry(${item.id})">‚úï</button>
            </div>
        `).join('');
    }

    function showDetails(id) {
        const history = JSON.parse(localStorage.getItem('lightHistoryDetailed') || '[]');
        const item = history.find(i => i.id === id);
        if (!item) return;

        document.getElementById('modal-title').innerText = `–ó–∞–ø–∏—Å—å –æ—Ç ${item.date}`;
        document.getElementById('modal-body').innerHTML = `
            <strong>–û–±—â–µ–µ –≤—Ä–µ–º—è:</strong> ${item.total}<br><br>
            <strong>–ü—Ä–æ–º–µ–∂—É—Ç–∫–∏:</strong><br>
            ${item.details.map((d, i) => `${i+1}. ${d}`).join('<br>')}
        `;
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
    }

    function deleteEntry(id) {
        let history = JSON.parse(localStorage.getItem('lightHistoryDetailed') || '[]');
        history = history.filter(i => i.id !== id);
        localStorage.setItem('lightHistoryDetailed', JSON.stringify(history));
        renderHistory();
    }

    function clearHistory() {
        if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å—ë?')) {
            localStorage.removeItem('lightHistoryDetailed');
            renderHistory();
        }
    }
</script>

</body>
</html>